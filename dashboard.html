<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TerraBook Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf"></script>
<script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" defer></script>
<style>
  /* Reset & basics */
  * {
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
  }
  body,html {
    margin: 0; padding: 0; height: 100%;
    background: var(--bg-color);
    color: var(--text-color);
    transition: background 0.5s ease, color 0.5s ease;
    --bg-color: #f4fdf7;
    --sidebar-bg: #2e7d32;
    --sidebar-hover: #4caf50;
    --text-color: #000;
    --card-bg: #fff;
    --box-shadow: 0px 44px 84px 6px #d8d9db;
  }
  body.dark {
    --bg-color: #121212;
    --sidebar-bg: #1b3a1a;
    --sidebar-hover: #388e3c;
    --text-color: #eee;
    --card-bg: #1e1e1e;
    --box-shadow: 0 0 12px 1px rgba(0,0,0,0.7);
  }

  /* Layout */
  #app {
    display: flex;
    height: 100vh;
    overflow: hidden;
  }
  nav.sidebar {
    width: 260px;
    background-color: var(--sidebar-bg);
    color: white;
    display: flex;
    flex-direction: column;
    border-radius: 0 30px 30px 0;
    box-shadow: var(--box-shadow);
    transition: width 0.3s ease;
    position: relative;
    user-select: none;
  }
  nav.sidebar.collapsed {
    width: 70px;
  }
  nav.sidebar .header {
    padding: 1.5rem 1.5rem;
    font-weight: 700;
    font-size: 1.5rem;
    text-align: center;
    border-bottom: 1px solid rgba(255 255 255 / 0.2);
    letter-spacing: 2px;
  }
  nav.sidebar.collapsed .header {
    font-size: 1.2rem;
    padding: 1.5rem 0;
  }

  nav.sidebar .nav-links {
    flex: 1;
    overflow-y: auto;
    padding: 1rem 0;
  }
  nav.sidebar .nav-links a {
    display: flex;
    align-items: center;
    padding: 0.85rem 1.5rem;
    color: white;
    text-decoration: none;
    font-weight: 600;
    font-size: 1rem;
    border-radius: 10px;
    margin: 0 1rem 10px 1rem;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s;
    outline-offset: 2px;
  }
  nav.sidebar .nav-links a svg {
    width: 22px;
    height: 22px;
    margin-right: 15px;
    min-width: 22px;
    fill: white;
    flex-shrink: 0;
  }
  nav.sidebar.collapsed .nav-links a svg {
    margin-right: 0;
  }
  nav.sidebar.collapsed .nav-links a span.label {
    display: none;
  }
  nav.sidebar .nav-links a:hover,
  nav.sidebar .nav-links a:focus {
    background-color: var(--sidebar-hover);
    transform: translateX(5px);
    outline: none;
  }
  nav.sidebar .nav-links a.active {
    background-color: var(--sidebar-hover);
    font-weight: 700;
    pointer-events: none;
  }
  nav.sidebar .collapse-btn {
    cursor: pointer;
    padding: 1rem;
    text-align: center;
    font-size: 1.2rem;
    background-color: rgba(255 255 255 / 0.1);
    user-select: none;
    transition: background-color 0.3s;
  }
  nav.sidebar .collapse-btn:hover,
  nav.sidebar .collapse-btn:focus {
    background-color: rgba(255 255 255 / 0.2);
    outline: none;
  }

  main.main-content {
    flex: 1;
    background-color: var(--card-bg);
    margin: 20px;
    border-radius: 30px;
    box-shadow: var(--box-shadow);
    padding: 40px 60px;
    overflow-y: auto;
    position: relative;
    transition: background-color 0.5s ease, color 0.5s ease;
  }
  main.main-content.collapsed {
    margin-left: 90px;
  }

  /* Section content */
  section.tab-content {
    display: none;
    animation: fadeIn 0.5s ease forwards;
  }
  section.tab-content.active {
    display: block;
  }

  /* Cards for Dashboard */
  .cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(240px,1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  .card {
    background-color: var(--sidebar-bg);
    color: white;
    border-radius: 18px;
    padding: 25px 30px;
    box-shadow: 0 8px 20px rgb(0 0 0 / 0.15);
    cursor: pointer;
    transition: transform 0.3s ease;
    user-select: none;
  }
  .card:hover,
  .card:focus {
    transform: translateY(-5px);
    outline: none;
  }
  .card .title {
    font-weight: 600;
    font-size: 1.2rem;
    margin-bottom: 10px;
  }
  .card .number {
    font-size: 2rem;
    font-weight: 700;
  }

  /* Filters */
  .filter-group {
    margin-bottom: 20px;
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
  }
  .filter-group label {
    font-weight: 600;
    margin-right: 8px;
    user-select: none;
  }
  .filter-group select, .filter-group input[type="text"] {
    padding: 7px 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 1rem;
    min-width: 120px;
  }

  /* Tables */
  table.dataTable-table {
    width: 100% !important;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 6px rgb(0 0 0 / 0.1);
  }
  /* Export buttons */
  .export-btns {
    margin-top: 10px;
  }
  .export-btn {
    background: var(--sidebar-bg);
    color: white;
    border: none;
    padding: 8px 14px;
    margin-right: 8px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s;
  }
  .export-btn:hover {
    background: var(--sidebar-hover);
  }

  /* Notifications Panel */
  .notif-panel {
    position: fixed;
    top: 90px;
    right: 30px;
    width: 320px;
    max-height: 400px;
    background-color: var(--card-bg);
    border-radius: 16px;
    box-shadow: var(--box-shadow);
    overflow-y: auto;
    padding: 20px;
    z-index: 1000;
    display: none;
  }
  .notif-panel.active {
    display: block;
  }
  .notif-panel h4 {
    margin-top: 0;
    margin-bottom: 15px;
    font-weight: 700;
  }
  .notif-item {
    border-bottom: 1px solid #ddd;
    padding: 10px 0;
    font-size: 0.95rem;
    color: var(--text-color);
  }
  .notif-item:last-child {
    border-bottom: none;
  }
  .notif-timestamp {
    font-size: 0.75rem;
    color: gray;
  }
  .notif-bell {
    position: fixed;
    top: 25px;
    right: 30px;
    background-color: var(--sidebar-bg);
    color: white;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: var(--box-shadow);
    z-index: 1100;
    user-select: none;
  }
  .notif-bell:hover,
  .notif-bell:focus {
    background-color: var(--sidebar-hover);
    outline: none;
  }
  .notif-bell .badge {
    position: absolute;
    top: 6px;
    right: 6px;
    background-color: #f44336;
    color: white;
    font-weight: 700;
    font-size: 12px;
    padding: 2px 6px;
    border-radius: 12px;
  }

  /* Toast notifications */
  .toast {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background-color: var(--sidebar-bg);
    color: white;
    padding: 15px 25px;
    border-radius: 14px;
    box-shadow: var(--box-shadow);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s ease;
    user-select: none;
    z-index: 1200;
  }
  .toast.show {
    opacity: 1;
    pointer-events: auto;
  }

  /* Settings form */
  #settingsForm {
    max-width: 480px;
  }
  #settingsForm fieldset {
    border: none;
    margin-bottom: 25px;
  }
  #settingsForm legend {
    font-weight: 700;
    margin-bottom: 15px;
    font-size: 1.2rem;
  }
  #settingsForm label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    user-select: none;
  }
  #settingsForm input[type="text"],
  #settingsForm input[type="email"],
  #settingsForm input[type="password"],
  #settingsForm select {
    width: 100%;
    padding: 9px 12px;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 8px;
    margin-bottom: 15px;
    transition: border-color 0.3s;
    box-sizing: border-box;
  }
  #settingsForm input[type="checkbox"] {
    margin-right: 10px;
    vertical-align: middle;
  }
  #settingsForm button[type="submit"] {
    background-color: var(--sidebar-bg);
    color: white;
    border: none;
    padding: 12px 22px;
    border-radius: 12px;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #settingsForm button[type="submit"]:hover,
  #settingsForm button[type="submit"]:focus {
    background-color: var(--sidebar-hover);
    outline: none;
  }
  #saveMessage {
    color: #4caf50;
    font-weight: 700;
    margin-top: 12px;
    display: none;
  }

  /* Search bar */
  #globalSearch {
    width: 100%;
    max-width: 420px;
    padding: 12px 18px;
    border-radius: 12px;
    border: 1px solid #ccc;
    margin-bottom: 30px;
    font-size: 1rem;
    outline-offset: 2px;
    transition: border-color 0.3s;
  }
  #globalSearch:focus {
    border-color: var(--sidebar-bg);
  }

  /* Animations */
  @keyframes fadeIn {
    from {opacity: 0; transform: translateY(20px);}
    to {opacity: 1; transform: translateY(0);}
  }

  /* Responsive */
  @media (max-width: 1024px) {
    nav.sidebar {
      position: fixed;
      height: 100%;
      top: 0;
      left: 0;
      border-radius: 0;
      width: 240px;
      z-index: 1500;
      box-shadow: none;
    }
    nav.sidebar.collapsed {
      width: 70px;
    }
    main.main-content {
      margin: 20px 15px 20px 260px;
      padding: 20px 25px;
    }
    main.main-content.collapsed {
      margin-left: 90px;
    }
  }
  @media (max-width: 600px) {
    nav.sidebar {
      width: 100vw;
      height: 100vh;
      border-radius: 0;
      display: none;
    }
    nav.sidebar.active {
      display: flex;
    }
    main.main-content {
      margin: 20px 15px;
      padding: 15px;
    }
  }
</style>
</head>
<body>

<div id="app">
  <!-- Sidebar -->
  <nav class="sidebar" aria-label="Main Navigation" role="navigation" tabindex="0">
    <div class="header" tabindex="0">TerraBook</div>
    <div class="nav-links" role="menu" aria-orientation="vertical">
      <a href="#" role="menuitem" aria-current="page" tabindex="0" data-tab="dashboard" class="active" aria-label="Dashboard">
        <svg viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8v-10h-8v10zm0-18v6h8V3h-8z"/></svg><span class="label">Dashboard</span>
      </a>
      <a href="#" role="menuitem" tabindex="0" data-tab="bookings" aria-label="Bookings">
        <svg viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2zm0 16H5V8h14z"/></svg><span class="label">Bookings</span>
      </a>
      <a href="#" role="menuitem" tabindex="0" data-tab="listings" aria-label="Listings">
        <svg viewBox="0 0 24 24"><path d="M3 5v14h18V5H3zm16 12H5V7h14v10z"/></svg><span class="label">Listings</span>
      </a>
      <a href="#" role="menuitem" tabindex="0" data-tab="customers" aria-label="Customers">
        <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05a5.503 5.503 0 0 1 5.22 5.45V19h2v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg><span class="label">Customers</span>
      </a>
      <a href="#" role="menuitem" tabindex="0" data-tab="revenue" aria-label="Revenue">
        <svg viewBox="0 0 24 24"><path d="M12 3L1 9l11 6 9-4.91V17h2V9L12 3zm0 9.5L5.5 9l6.5-3.77 5.5 2.99-6.5 3.28z"/></svg><span class="label">Revenue</span>
      </a>
      <a href="#" role="menuitem" tabindex="0" data-tab="impact" aria-label="Impact">
        <svg viewBox="0 0 24 24"><path d="M20 21V7.5L12 2 4 7.5V21h16zM12 15.5l-4-2.17v-4.5l4-2.17 4 2.17v4.5l-4 2.17z"/></svg><span class="label">Impact</span>
      </a>
      <a href="#" role="menuitem" tabindex="0" data-tab="reports" aria-label="Reports">
        <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/></svg><span class="label">Reports</span>
      </a>
      <a href="#" role="menuitem" tabindex="0" data-tab="settings" aria-label="Settings">
        <svg viewBox="0 0 24 24"><path d="M19.14 12.94a1.5 1.5 0 0 0 0-1.88l2.09-1.65-2-3.46-2.48 1a5.995 5.995 0 0 0-1.52-0.88l-0.37-2.65H9.52l-0.37 2.65a5.978 5.978 0 0 0-1.52 0.88l-2.48-1-2 3.46 2.09 1.65a1.5 1.5 0 0 0 0 1.88L3.19 14.6l2 3.46 2.48-1a5.995 5.995 0 0 0 1.52 0.88l0.37 2.65h3.06l0.37-2.65a5.978 5.978 0 0 0 1.52-0.88l2.48 1 2-3.46-2.09-1.65zM12 15.5a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7z"/></svg><span class="label">Settings</span>
      </a>
    </div>
    <button class="collapse-btn" aria-label="Collapse Sidebar" tabindex="0" title="Toggle Sidebar">â˜°</button>
  </nav>

  <!-- Main Content -->
  <main class="main-content" role="main" tabindex="0" aria-live="polite" aria-atomic="true">

    <input type="search" id="globalSearch" placeholder="Search bookings, listings, customers..." aria-label="Global Search" />

    <!-- Dashboard Tab -->
    <section id="dashboard" class="tab-content active" role="tabpanel" aria-labelledby="Dashboard">
      <h1>Dashboard Overview</h1>
      <div class="cards-container" role="list" aria-label="Dashboard summary cards">
        <div class="card" tabindex="0" role="listitem" aria-label="Total Bookings">
          <div class="title">Total Bookings</div>
          <div class="number" id="cardBookings">1542</div>
        </div>
        <div class="card" tabindex="0" role="listitem" aria-label="Total Revenue">
          <div class="title">Total Revenue</div>
          <div class="number" id="cardRevenue">$284,654</div>
        </div>
        <div class="card" tabindex="0" role="listitem" aria-label="Active Listings">
          <div class="title">Active Listings</div>
          <div class="number" id="cardListings">124</div>
        </div>
        <div class="card" tabindex="0" role="listitem" aria-label="New Customers">
          <div class="title">New Customers</div>
          <div class="number" id="cardCustomers">62</div>
        </div>
      </div>

      <canvas id="liveChart" aria-label="Sales Over Time Chart" role="img" height="250"></canvas>
      <canvas id="pieChart" aria-label="Booking Types Distribution" role="img" height="250" style="margin-top:40px;"></canvas>
    </section>

    <!-- Bookings Tab -->
    <section id="bookings" class="tab-content" role="tabpanel" aria-labelledby="Bookings">
      <h1>Bookings</h1>
      <div class="filter-group" role="group" aria-label="Bookings filters">
        <label for="bookingStatusFilter">Status:</label>
        <select id="bookingStatusFilter" aria-controls="bookingTable">
          <option value="all">All</option>
          <option value="confirmed">Confirmed</option>
          <option value="pending">Pending</option>
          <option value="cancelled">Cancelled</option>
        </select>

        <label for="bookingSearch">Search:</label>
        <input type="text" id="bookingSearch" aria-controls="bookingTable" placeholder="Search bookings..." />
      </div>

      <table id="bookingTable" aria-describedby="bookingDesc" role="grid" tabindex="0">
        <caption id="bookingDesc" class="sr-only">Table showing booking details including ID, customer, date, status, and amount</caption>
        <thead>
          <tr>
            <th>Booking ID</th>
            <th>Customer</th>
            <th>Date</th>
            <th>Status</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody id="bookingTbody">
          <!-- JS fills -->
        </tbody>
      </table>
      <div class="export-btns" role="group" aria-label="Export Booking Data">
        <button class="export-btn" id="exportBookingCSV">Export CSV</button>
        <button class="export-btn" id="exportBookingPDF">Export PDF</button>
      </div>
    </section>

    <!-- Listings Tab -->
    <section id="listings" class="tab-content" role="tabpanel" aria-labelledby="Listings">
      <h1>Listings</h1>
      <div class="filter-group" role="group" aria-label="Listings filters">
        <label for="listingTypeFilter">Type:</label>
        <select id="listingTypeFilter" aria-controls="listingTable">
          <option value="all">All</option>
          <option value="hotel">Hotel</option>
          <option value="restaurant">Restaurant</option>
          <option value="adventure">Eco Adventure</option>
        </select>

        <label for="listingSearch">Search:</label>
        <input type="text" id="listingSearch" aria-controls="listingTable" placeholder="Search listings..." />
      </div>

      <table id="listingTable" aria-describedby="listingDesc" role="grid" tabindex="0">
        <caption id="listingDesc" class="sr-only">Table showing property listings with name, type, location, and rating</caption>
        <thead>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Location</th>
            <th>Rating</th>
          </tr>
        </thead>
        <tbody id="listingTbody">
          <!-- JS fills -->
        </tbody>
      </table>
      <div class="export-btns" role="group" aria-label="Export Listing Data">
        <button class="export-btn" id="exportListingCSV">Export CSV</button>
        <button class="export-btn" id="exportListingPDF">Export PDF</button>
      </div>
    </section>

    <!-- Customers Tab -->
    <section id="customers" class="tab-content" role="tabpanel" aria-labelledby="Customers">
      <h1>Customers</h1>
      <div class="filter-group" role="group" aria-label="Customer filters">
        <label for="customerSearch">Search:</label>
        <input type="text" id="customerSearch" aria-controls="customerTable" placeholder="Search customers..." />
      </div>
      <table id="customerTable" aria-describedby="customerDesc" role="grid" tabindex="0">
        <caption id="customerDesc" class="sr-only">Table showing customer details like name, email, and signup date</caption>
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Signup Date</th>
          </tr>
        </thead>
        <tbody id="customerTbody"></tbody>
      </table>
      <div class="export-btns" role="group" aria-label="Export Customer Data">
        <button class="export-btn" id="exportCustomerCSV">Export CSV</button>
        <button class="export-btn" id="exportCustomerPDF">Export PDF</button>
      </div>
    </section>

    <!-- Revenue Tab -->
    <section id="revenue" class="tab-content" role="tabpanel" aria-labelledby="Revenue">
      <h1>Revenue</h1>
      <canvas id="revenueChart" aria-label="Revenue over months chart" role="img" height="300"></canvas>
      <div class="filter-group" role="group" aria-label="Revenue filters" style="margin-top:20px;">
        <label for="revenueYearFilter">Year:</label>
        <select id="revenueYearFilter" aria-controls="revenueChart">
          <option value="2025">2025</option>
          <option value="2024" selected>2024</option>
          <option value="2023">2023</option>
          <option value="2022">2022</option>
        </select>
      </div>
    </section>

    <!-- Impact Tab -->
    <section id="impact" class="tab-content" role="tabpanel" aria-labelledby="Impact">
      <h1>Impact</h1>
      <p>Metrics about TerraBook's environmental and social impact will be shown here.</p>
      <canvas id="impactChart" aria-label="Environmental Impact Chart" role="img" height="300"></canvas>
    </section>

    <!-- Reports Tab -->
    <section id="reports" class="tab-content" role="tabpanel" aria-labelledby="Reports">
      <h1>Reports</h1>
      <p>Generate downloadable reports based on your data.</p>
      <div class="export-btns" role="group" aria-label="Download Reports">
        <button class="export-btn" id="downloadFullReport">Download Full Report (PDF)</button>
      </div>
    </section>

    <!-- Settings Tab -->
    <section id="settings" class="tab-content" role="tabpanel" aria-labelledby="Settings">
      <h1>Settings</h1>
      <form id="settingsForm" aria-label="User Settings Form">
        <fieldset>
          <legend>Profile Information</legend>
          <label for="profileName">Full Name</label>
          <input type="text" id="profileName" name="profileName" required aria-required="true" />
          <label for="profileEmail">Email Address</label>
          <input type="email" id="profileEmail" name="profileEmail" required aria-required="true" />
        </fieldset>
        <fieldset>
          <legend>Security</legend>
          <label for="profilePassword">Change Password</label>
          <input type="password" id="profilePassword" name="profilePassword" placeholder="Leave blank to keep current" aria-describedby="passwordHelp" />
          <small id="passwordHelp">Password must be at least 8 characters.</small>
          <label>
            <input type="checkbox" id="twoFactorToggle" name="twoFactorToggle" />
            Enable Two-Factor Authentication (2FA)
          </label>
        </fieldset>
        <fieldset>
          <legend>Preferences</legend>
          <label for="themeSelect">Theme</label>
          <select id="themeSelect" name="themeSelect" aria-live="polite">
            <option value="light">Light Mode</option>
            <option value="dark">Dark Mode</option>
          </select>
          <label for="languageSelect">Language</label>
          <select id="languageSelect" name="languageSelect">
            <option value="en" selected>English</option>
            <option value="fr">French</option>
            <option value="es">Spanish</option>
            <option value="de">German</option>
          </select>
        </fieldset>
        <button type="submit">Save Settings</button>
        <div id="saveMessage" role="alert" aria-live="assertive">Settings saved successfully!</div>
      </form>
    </section>

  </main>
</div>

<!-- Notification Bell -->
<button class="notif-bell" aria-label="Toggle Notifications" title="Toggle Notifications" aria-haspopup="true" aria-expanded="false" id="notifToggle">
  <svg aria-hidden="true" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
    <path d="M12 22c1.1 0 1.99-.9 1.99-2H10c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5S10.5 3.17 10.5 4v.68C7.63 5.36 6 7.92 6 11v5l-1.99 2h15.98L18 16z"/>
  </svg>
  <span class="badge" id="notifCount" aria-label="Number of unread notifications">0</span>
</button>

<!-- Notifications Panel -->
<div class="notif-panel" role="region" aria-live="polite" aria-atomic="true" aria-label="Notifications" id="notifPanel" tabindex="0">
  <h4>Notifications</h4>
  <div id="notifList"></div>
</div>

<!-- Toast notification -->
<div class="toast" role="alert" aria-live="assertive" aria-atomic="true" id="toast"></div>

<script>
  (() => {
    // Utility functions
    const $ = (selector, ctx=document) => ctx.querySelector(selector);
    const $$ = (selector, ctx=document) => [...ctx.querySelectorAll(selector)];

    // Sidebar toggle
    const sidebar = $('.sidebar');
    const collapseBtn = $('.collapse-btn');
    const mainContent = $('.main-content');
    const navLinks = $$('.nav-links a');
    let sidebarCollapsed = false;

    collapseBtn.addEventListener('click', () => {
      sidebarCollapsed = !sidebarCollapsed;
      sidebar.classList.toggle('collapsed', sidebarCollapsed);
      mainContent.classList.toggle('collapsed', sidebarCollapsed);
      collapseBtn.setAttribute('aria-expanded', String(!sidebarCollapsed));
    });

    // Keyboard nav for sidebar
    navLinks.forEach(link => {
      link.addEventListener('keydown', e => {
        if(e.key === 'ArrowDown') {
          e.preventDefault();
          const next = link.parentElement.nextElementSibling || navLinks[0].parentElement;
          const nextLink = next.querySelector('a');
          nextLink.focus();
        } else if(e.key === 'ArrowUp') {
          e.preventDefault();
          const prev = link.parentElement.previousElementSibling || navLinks[navLinks.length - 1].parentElement;
          const prevLink = prev.querySelector('a');
          prevLink.focus();
        }
      });
    });

    // Tab switching logic
    function activateTab(tabName) {
      navLinks.forEach(link => {
        if(link.dataset.tab === tabName) {
          link.classList.add('active');
          link.setAttribute('aria-current', 'page');
        } else {
          link.classList.remove('active');
          link.removeAttribute('aria-current');
        }
      });
      $$('.tab-content').forEach(section => {
        section.classList.toggle('active', section.id === tabName);
      });
      // Focus main content for screen readers
      mainContent.focus();
      if(tabName === 'dashboard') {
        updateDashboardCards();
      }
    }
    navLinks.forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        activateTab(link.dataset.tab);
      });
    });

    // Data (Mock Data)
    const bookings = [
      {id:'B001', customer:'Alice Johnson', date:'2025-07-01', status:'confirmed', amount:120.00},
      {id:'B002', customer:'Bob Smith', date:'2025-07-03', status:'pending', amount:340.00},
      {id:'B003', customer:'Cara Lee', date:'2025-07-04', status:'cancelled', amount:0},
      {id:'B004', customer:'David Kim', date:'2025-07-05', status:'confirmed', amount:215.50},
      {id:'B005', customer:'Eva Green', date:'2025-07-06', status:'confirmed', amount:120.00},
      {id:'B006', customer:'Fred Black', date:'2025-07-07', status:'pending', amount:150.00},
      {id:'B007', customer:'Grace Chan', date:'2025-07-08', status:'confirmed', amount:305.75},
      {id:'B008', customer:'Harry White', date:'2025-07-09', status:'cancelled', amount:0},
      {id:'B009', customer:'Ivy Wong', date:'2025-07-10', status:'confirmed', amount:500.00},
      {id:'B010', customer:'Jack Brown', date:'2025-07-11', status:'pending', amount:80.00},
    ];

    const listings = [
      {name:'Green Hills Hotel', type:'hotel', location:'Cape Town', rating:4.5},
      {name:'Ocean Breeze Restaurant', type:'restaurant', location:'Durban', rating:4.2},
      {name:'Safari Eco Adventure', type:'adventure', location:'Kruger Park', rating:4.8},
      {name:'Mountain View Hotel', type:'hotel', location:'Drakensberg', rating:4.1},
      {name:'River Delight Restaurant', type:'restaurant', location:'Johannesburg', rating:4.3},
      {name:'Jungle Trek Adventure', type:'adventure', location:'Maputo', rating:4.7},
    ];

    const customers = [
      {name:'Alice Johnson', email:'alice@example.com', signup:'2024-11-15'},
      {name:'Bob Smith', email:'bob@example.com', signup:'2025-01-08'},
      {name:'Cara Lee', email:'cara@example.com', signup:'2024-08-21'},
      {name:'David Kim', email:'david@example.com', signup:'2024-09-30'},
      {name:'Eva Green', email:'eva@example.com', signup:'2025-03-12'},
      {name:'Fred Black', email:'fred@example.com', signup:'2024-12-02'},
      {name:'Grace Chan', email:'grace@example.com', signup:'2024-07-15'},
      {name:'Harry White', email:'harry@example.com', signup:'2025-06-20'},
      {name:'Ivy Wong', email:'ivy@example.com', signup:'2025-05-05'},
      {name:'Jack Brown', email:'jack@example.com', signup:'2025-06-10'},
    ];

    // Populate bookings table
    const bookingTbody = $('#bookingTbody');
    function renderBookingsTable(filterStatus='all', search='') {
      const filtered = bookings.filter(b => 
        (filterStatus === 'all' || b.status === filterStatus) &&
        (b.id.toLowerCase().includes(search.toLowerCase()) || 
         b.customer.toLowerCase().includes(search.toLowerCase()) )
      );
      bookingTbody.innerHTML = filtered.map(b => `
        <tr tabindex="0" aria-label="Booking ${b.id} for ${b.customer}, status ${b.status}, amount $${b.amount.toFixed(2)}">
          <td>${b.id}</td>
          <td>${b.customer}</td>
          <td>${b.date}</td>
          <td>${capitalize(b.status)}</td>
          <td>$${b.amount.toFixed(2)}</td>
        </tr>
      `).join('');
    }

    // Populate listings table
    const listingTbody = $('#listingTbody');
    function renderListingsTable(filterType='all', search='') {
      const filtered = listings.filter(l =>
        (filterType === 'all' || l.type === filterType) &&
        (l.name.toLowerCase().includes(search.toLowerCase()) ||
         l.location.toLowerCase().includes(search.toLowerCase()))
      );
      listingTbody.innerHTML = filtered.map(l => `
        <tr tabindex="0" aria-label="${l.name}, a ${capitalize(l.type)} located in ${l.location} with rating ${l.rating}">
          <td>${l.name}</td>
          <td>${capitalize(l.type)}</td>
          <td>${l.location}</td>
          <td>${l.rating.toFixed(1)}</td>
        </tr>
      `).join('');
    }

    // Populate customers table
    const customerTbody = $('#customerTbody');
    function renderCustomersTable(search='') {
      const filtered = customers.filter(c =>
        c.name.toLowerCase().includes(search.toLowerCase()) || 
        c.email.toLowerCase().includes(search.toLowerCase())
      );
      customerTbody.innerHTML = filtered.map(c => `
        <tr tabindex="0" aria-label="${c.name}, email ${c.email}, signed up on ${c.signup}">
          <td>${c.name}</td>
          <td>${c.email}</td>
          <td>${c.signup}</td>
        </tr>
      `).join('');
    }

    // Helper function
    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    // Filters and Search inputs
    $('#bookingStatusFilter').addEventListener('change', e => {
      renderBookingsTable(e.target.value, $('#bookingSearch').value);
    });
    $('#bookingSearch').addEventListener('input', e => {
      renderBookingsTable($('#bookingStatusFilter').value, e.target.value);
    });

    $('#listingTypeFilter').addEventListener('change', e => {
      renderListingsTable(e.target.value, $('#listingSearch').value);
    });
    $('#listingSearch').addEventListener('input', e => {
      renderListingsTable($('#listingTypeFilter').value, e.target.value);
    });

    $('#customerSearch').addEventListener('input', e => {
      renderCustomersTable(e.target.value);
    });

    // Global Search across bookings, listings, customers
    const globalSearch = $('#globalSearch');
    globalSearch.addEventListener('input', e => {
      const val = e.target.value.toLowerCase();
      // When user types in global search, switch to bookings tab and filter all tables for demo simplicity
      activateTab('bookings');
      renderBookingsTable('all', val);
      renderListingsTable('all', val);
      renderCustomersTable(val);
    });

    // Export CSV and PDF (basic implementations)
    function exportTableToCSV(tableId, filename) {
      const rows = [];
      const table = document.getElementById(tableId);
      for(let row of table.rows) {
        let cols = [];
        for(let cell of row.cells) {
          cols.push('"' + cell.textContent.replace(/"/g, '""') + '"');
        }
        rows.push(cols.join(","));
      }
      const csvContent = rows.join("\n");
      const blob = new Blob([csvContent], {type: "text/csv;charset=utf-8;"});
      saveAs(blob, filename);
    }
    function exportTableToPDF(tableId, filename) {
      const doc = new jsPDF();
      doc.text("Report", 10, 10);
      doc.autoTable({ html: '#' + tableId, startY: 20 });
      doc.save(filename);
    }

    $('#exportBookingCSV').addEventListener('click', () => exportTableToCSV('bookingTable', 'bookings.csv'));
    $('#exportBookingPDF').addEventListener('click', () => {
      alert("PDF export for tables requires advanced implementation or server-side support.");
    });
    $('#exportListingCSV').addEventListener('click', () => exportTableToCSV('listingTable', 'listings.csv'));
    $('#exportListingPDF').addEventListener('click', () => {
      alert("PDF export for tables requires advanced implementation or server-side support.");
    });
    $('#exportCustomerCSV').addEventListener('click', () => exportTableToCSV('customerTable', 'customers.csv'));
    $('#exportCustomerPDF').addEventListener('click', () => {
      alert("PDF export for tables requires advanced implementation or server-side support.");
    });

    // Dashboard cards update - dynamically from data
    function updateDashboardCards() {
      $('#cardBookings').textContent = bookings.length;
      const totalRevenue = bookings.reduce((sum, b) => sum + b.amount, 0);
      $('#cardRevenue').textContent = '$' + totalRevenue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
      $('#cardListings').textContent = listings.length;
      $('#cardCustomers').textContent = customers.length;
    }
    updateDashboardCards();

    // Chart.js charts setup
    let liveChartCtx = $('#liveChart').getContext('2d');
    let pieChartCtx = $('#pieChart').getContext('2d');
    let revenueChartCtx = $('#revenueChart').getContext('2d');
    let impactChartCtx = $('#impactChart').getContext('2d');

    // Sales Over Time (Line chart)
    const liveChart = new Chart(liveChartCtx, {
      type: 'line',
      data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
        datasets: [{
          label: 'Bookings',
          data: [30, 45, 60, 55, 70, 90, 100],
          backgroundColor: 'rgba(46,125,50,0.2)',
          borderColor: 'rgba(46,125,50,1)',
          borderWidth: 2,
          fill: true,
          tension: 0.4,
          pointRadius: 5,
          pointHoverRadius: 7,
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: true },
          tooltip: { mode: 'index', intersect: false }
        },
        interaction: {
          mode: 'nearest',
          axis: 'x',
          intersect: false
        },
        scales: {
          y: {
            beginAtZero: true,
            title: { display: true, text: 'Bookings' }
          }
        }
      }
    });

    // Booking types pie chart
    const pieChart = new Chart(pieChartCtx, {
      type: 'pie',
      data: {
        labels: ['Hotels', 'Restaurants', 'Eco Adventures'],
        datasets: [{
          label: 'Booking Types',
          data: [55, 25, 20],
          backgroundColor: ['#388e3c', '#81c784', '#a5d6a7']
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' },
          tooltip: { enabled: true }
        }
      }
    });

    // Revenue bar chart per month
    let revenueChart;
    function updateRevenueChart(year = '2024') {
      const revenueDataByYear = {
        '2022': [12000, 15000, 14000, 13000, 17000, 19000, 22000, 20000, 21000, 23000, 25000, 27000],
        '2023': [15000, 18000, 17000, 16000, 20000, 21000, 24000, 22000, 23000, 25000, 27000, 30000],
        '2024': [18000, 20000, 21000, 23000, 25000, 27000, 29000, 31000, 32000, 35000, 37000, 40000],
        '2025': [20000, 22000, 24000, 26000, 28000, 30000, 32000, 34000, 36000, 38000, 40000, 42000]
      };
      if(revenueChart) revenueChart.destroy();
      revenueChart = new Chart(revenueChartCtx, {
        type: 'bar',
        data: {
          labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
          datasets: [{
            label: `Revenue in USD (${year})`,
            data: revenueDataByYear[year],
            backgroundColor: 'rgba(46,125,50,0.8)'
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: true }, tooltip: { enabled: true }},
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'Revenue (USD)' }
            }
          }
        }
      });
    }
    $('#revenueYearFilter').addEventListener('change', e => {
      updateRevenueChart(e.target.value);
    });
    updateRevenueChart();

    // Impact chart (Doughnut)
    const impactChart = new Chart(impactChartCtx, {
      type: 'doughnut',
      data: {
        labels: ['Carbon Offset', 'Water Saved', 'Waste Reduced', 'Community Support'],
        datasets: [{
          label: 'Impact Metrics',
          data: [1200, 900, 600, 300],
          backgroundColor: ['#388e3c', '#81c784', '#a5d6a7', '#c8e6c9']
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' },
          tooltip: { enabled: true }
        }
      }
    });

    // Settings form handling
    const settingsForm = $('#settingsForm');
    const saveMessage = $('#saveMessage');
    settingsForm.addEventListener('submit', e => {
      e.preventDefault();
      // Save form values to localStorage (simulate saving)
      localStorage.setItem('profileName', $('#profileName').value);
      localStorage.setItem('profileEmail', $('#profileEmail').value);
      localStorage.setItem('theme', $('#themeSelect').value);
      localStorage.setItem('language', $('#languageSelect').value);
      localStorage.setItem('2fa', $('#twoFactorToggle').checked);
      showToast("Settings saved!");
      saveMessage.style.display = 'block';
      setTimeout(() => saveMessage.style.display = 'none', 3000);
      applyTheme($('#themeSelect').value);
    });
    // Load saved settings
    function loadSettings() {
      $('#profileName').value = localStorage.getItem('profileName') || 'John Doe';
      $('#profileEmail').value = localStorage.getItem('profileEmail') || 'john@example.com';
      $('#themeSelect').value = localStorage.getItem('theme') || 'light';
      $('#languageSelect').value = localStorage.getItem('language') || 'en';
      $('#twoFactorToggle').checked = localStorage.getItem('2fa') === 'true';
      applyTheme($('#themeSelect').value);
    }
    loadSettings();

    // Theme toggling
    function applyTheme(theme) {
      if(theme === 'dark') {
        document.body.classList.add('dark');
      } else {
        document.body.classList.remove('dark');
      }
    }
    $('#themeSelect').addEventListener('change', e => applyTheme(e.target.value));

    // Notifications (mock)
    const notifToggle = $('#notifToggle');
    const notifPanel = $('#notifPanel');
    const notifList = $('#notifList');
    const notifCount = $('#notifCount');
    let notifications = [
      {id:1, text:'New booking from Alice Johnson', time:'2 minutes ago', read:false},
      {id:2, text:'Listing "Green Hills Hotel" updated', time:'1 hour ago', read:false},
      {id:3, text:'Monthly report generated', time:'Yesterday', read:true},
    ];
    function renderNotifications() {
      notifList.innerHTML = notifications.map(n =>
        `<div class="notif-item" aria-live="polite" role="alert" tabindex="0" aria-label="Notification: ${n.text}">
          <span>${n.text}</span><small>${n.time}</small>
        </div>`).join('');
      const unreadCount = notifications.filter(n => !n.read).length;
      notifCount.textContent = unreadCount;
      notifToggle.setAttribute('aria-expanded', String(notifPanel.style.display === 'block'));
    }
    notifToggle.addEventListener('click', () => {
      if(notifPanel.style.display === 'block') {
        notifPanel.style.display = 'none';
        notifToggle.setAttribute('aria-expanded', 'false');
      } else {
        notifPanel.style.display = 'block';
        notifToggle.setAttribute('aria-expanded', 'true');
        notifications.forEach(n => n.read = true);
        renderNotifications();
      }
    });
    renderNotifications();

    // Toast notification
    const toast = $('#toast');
    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // Initial render tables
    renderBookingsTable();
    renderListingsTable();
    renderCustomersTable();

    // Activate default tab
    activateTab('dashboard');

    // Accessibility: trap focus inside sidebar when open
    // (Implementation omitted for brevity)

    // SaveAs function (for CSV export)
    function saveAs(blob, filename) {
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.style.display = 'none';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  })();
</script>

<!-- Libraries for PDF export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-Gq/bvrs43rPoxQ5e2GnsrqAdFeqN82knCEpgAlk5Zt0Z1v2lKgCq4CvjDrUR/f6QsxjoIm7XFCFXALkFq5ozrA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js" integrity="sha512-RUt88k4Nf8RkgoqQ4txIfa3PAIuUMzDdyY/mUo1YmRM/vlPF4Z+lT6r3VScbj3UD5Nv3Z9+dTWhUzlrnyHLNg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</body>
</html>
